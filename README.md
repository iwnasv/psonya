# psonya
wrapper for supermarket product data

## Base URL

The base URL for the Product API is `https://analipsi.online`.

## Authentication

To access the Product API, you need to provide an API key as a query parameter `key` in the request URL. The API key must be a SHA256 hash of the actual API key. The API key is used to authenticate and authorize access to certain endpoints.

## Endpoints

1. **Get Product Information**
   - URL: `/products?id={product_id}&key={api_key}`
   - Method: GET
   - Description: This endpoint allows you to retrieve information about a specific product based on its unique product ID. The product ID is not consistent because the data source handles its data that way. Might work around this in the future, for now you need to count on product names to keep track of specific items.
   - Parameters:
     - `id`: (required) The product ID for which you want to retrieve information.
     - `key`: (required) The unhashed API key used for authentication.

   - Response:
     - Success (200 OK): Returns the product information in JSON format with the following attributes:
       - `code`: The unique product ID.
       - `name`: The name of the product.
       - `price`: The price of the product.
       - `store`: The name of the store where the product is available at this price.
       - `pic`: The URL of the product image.
     - Error (400 Bad Request): Returns a JSON response with an error message if the product ID or API key is missing in the request.
     - Error (403 Forbidden): Returns a JSON response with an error message if the provided API key is invalid.
     - Error (404 Not Found): Returns a JSON response with an error message if the requested product is not found.

2. **Get All Products**
   - URL: `/products?id=0&key={api_key}`
   - Method: GET
   - Description: This endpoint allows you to retrieve information about all products available in the system. It's not available if the script's running with the -x (live fetch on each request) argument. Why is it called -x? Because x is the cool letter and this functionality is cool.
   - Parameters:
     - `id`: (required) Set this parameter to 0 to get information about all products.
     - `key`: (required) The unhashed API key used for authentication.

   - Response:
     - Success (200 OK): Returns a JSON response containing information about all products in the system. The response is an array of product objects, each with the same attributes as described in the "Get Product Information" endpoint.
     - Error (400 Bad Request): Returns a JSON response with an error message if the API key is missing in the request.
     - Error (403 Forbidden): Returns a JSON response with an error message if the provided API key is invalid.

## Examples

1. Get Product Information:
   - Request: `GET http://127.0.0.1:5000/products?id=123&key=API_KEY`
   - Response (Success):
     ```json
     {
       "code": 123,
       "name": "Pedigree Œ£Œ∫œÖŒª/Œ¶ŒÆ ŒúŒøœÉœáŒ¨œÅŒπ 400Œ≥œÅ",
       "pic": "https://warply.s3.amazonaws.com/applications/ed840ad545884deeb6c6b699176797ed/products/%CE%A3%CE%BA%CF%85%CE%BB%CE%A6%CE%B7_%CE%9C%CE%BF%CF%83%CF%87%CE%B1%CF%81%CE%B9_Pal_400%CE%93.jpg",
       "price": "2.23‚Ç¨",
       "store": "ŒöŒ°ŒóŒ§ŒôŒöŒüŒ£"
     }
     ```
   - Response (Error - Product not found):
     ```json
     {
       "error": "Product not found."
     }
     ```

2. Get All Products:
   - Request: `GET http://127.0.0.1:5000/products?id=0&key=API_KEY`
   - Response (Success):
     ```json
     [
       {
         "code": 1,
         "name": "Product XYZ",
         "price": 12.99,
         "store": "Store ABC",
         "pic": "https://example.com/images/product_xyz.jpg"
       },
       {
         "code": 2,
         "name": "Product DEF",
         "price": 9.99,
         "store": "Store XYZ",
         "pic": "https://example.com/images/product_def.jpg"
       },
       ...
     ]
     ```

## Notes

- Replace `{product_id}` with the desired product ID and `{api_key}` with the actual API key when making requests.
- Remember to replace `'HASHED_API_KEY'` with the actual SHA256 hash of your API key before using the API.
- If the `-x` flag is used when running the server, product data will be fetched from an external source. Otherwise, product data will be loaded from a JSON file generated by cache_products.py.
- This is because the external website is very very poorly written and takes forever to serve a single request with a response consisting of massive javascript and disorder. Data is updated daily, which is just about enough time for us to fetch that data and generate a JSON file of all products to use as cache.
- Products increase and decrease, so their number currently needs to be found manually. I should add code to just keep going until two consecutive items aren't found... For now I do it manually.
- The Product API runs on `127.0.0.1` (localhost) at port `5000`. Make sure to configure your web server (e.g., NGINX) to forward requests to this address and port if necessary.

Have fun, Demosthenis. You know what to do üòé
