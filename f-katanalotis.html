<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>F-katanalotis</title>
</head>
<body>
    <h1>F-katanalotis</h1>
    <label for="productDropdown">Product:</label>
    <input type="text" id="filterDropdown" oninput="filterDropdown()" placeholder="Filter products">
    <select id="productDropdown">
        <option value="">Select...</option>
    </select>
    <button onclick="addProduct()">Add</button>
    <table id="productTable">
        <thead>
            <tr>
                <th>Image</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Store</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script>
        let products;
        async function fetchProducts() {
            const response = await fetch('https://analipsi.online/products?id=0&key=hackATH2023');
            const productsJson = await response.json();
            const productDropdown = document.getElementById('productDropdown');
            products = Object.values(productsJson);
            products.sort((a, b) => a.name.localeCompare(b.name));
            products.forEach((product) => {
                const option = document.createElement('option');
                option.value = product.name;
                option.textContent = product.name;
                productDropdown.appendChild(option);
            });
            renderSavedProducts();
        }
        function addProduct() {
            const productDropdown = document.getElementById('productDropdown');
            const selectedProductName = productDropdown.value;
            if (selectedProductName) {
                const productNames = getProductNamesFromCookie();
                productNames.push(selectedProductName);
                setProductNamesToCookie(productNames);
                renderSavedProducts();
            }
        }
        function filterDropdown() {
            const filterInput = document.getElementById('filterDropdown');
            const filterValue = filterInput.value.trim().toLowerCase();
            const productDropdown = document.getElementById('productDropdown');
            const options = productDropdown.options;
            for (let i = 0; i < options.length; i++) {
                const option = options[i];
                const productName = option.textContent.trim().toLowerCase();
                if (productName.includes(filterValue)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            }
        }
        function renderSavedProducts() {
            const productTableBody = document.querySelector('#productTable tbody');
            productTableBody.innerHTML = '';
            const productNames = getProductNamesFromCookie();
            productNames.forEach((productName) => {
                const product = products.find((p) => p.name === productName);
                if (product) {
                    const row = productTableBody.insertRow();
                    const imgCell = row.insertCell();
                    const nameCell = row.insertCell();
                    const priceCell = row.insertCell();
                    const storeCell = row.insertCell();
                    const actionCell = row.insertCell();
                    const img = document.createElement('img');
                    img.src = product.pic;
                    img.alt = product.name;
                    img.width = 100;
                    img.height = 100;
                    imgCell.appendChild(img);
                    nameCell.textContent = product.name;
                    priceCell.textContent = product.price;
                    storeCell.textContent = product.store;
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', () => deleteProduct(product.name));
                    actionCell.appendChild(deleteButton);
                }
            });
        }
        function getProductNamesFromCookie() {
            const productNamesCookie = getCookie('productNames');
            return productNamesCookie ? JSON.parse(productNamesCookie) : [];
        }
        function setProductNamesToCookie(productNames) {
            setCookie('productNames', JSON.stringify(productNames), 30);
        }
        function deleteProduct(productName) {
            const productNames = getProductNamesFromCookie();
            const updatedProductNames = productNames.filter((name) => name !== productName);
            setProductNamesToCookie(updatedProductNames);
            renderSavedProducts();
        }
        function getCookie(name) {
            const value = '; ' + document.cookie;
            const parts = value.split('; ' + name + '=');
            if (parts.length === 2) {
                return parts.pop().split(';').shift();
            }
        }
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = 'expires=' + date.toUTCString();
            document.cookie = name + '=' + value + ';' + expires + ';path=/';
        }
        fetchProducts();
    </script>
</body>
</html>
